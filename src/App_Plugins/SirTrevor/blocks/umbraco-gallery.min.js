SirTrevor.Blocks.UmbracoGallery=function(){function f(n){n.preventDefault();this.pickImages()}var t=angular.element("body").injector(),i=t.get("mediaHelper"),r=t.get("dialogService"),u=t.get("mediaResource"),n;return SirTrevor.Block.extend({type:"umbraco_gallery",title:function(){return"Gallery"},icon_name:"poll",droppable:!1,uploadable:!1,pastable:!1,ajaxable:!1,controllable:!0,controls:{add:f},loadData:function(t){n=this;this.$editor.empty();this.$editor.append($("<div>",{"class":"ust-gallery"}));angular.forEach(t.items,function(t){n.addImage(t.id)})},onBlockRender:function(){(typeof this.blockStorage.data.itemcount=="undefined"||this.blockStorage.data.itemcount<1)&&(n=this,this.pickImages())},pickImages:function(){r.mediaPicker({onlyImages:!0,callback:this.onMediaSelected,multiPicker:!0})},onMediaSelected:function(t){var i=[],r;angular.forEach(n.$editor.find(".ust-gallery .ust-gallery-preview"),function(n){var t={};t.id=$(n).data("mediaid");t.contentTypeAlias=$(n).data("mediacontenttypealias");i.push(t)});angular.forEach(t,function(n){var t={};t.id=n.id;t.contentTypeAlias=n.contentTypeAlias;i.push(t)});r={};r.itemcount=i.length;r.items=i;n.setAndLoadData(r);n.ready()},addImage:function(t){var r=n,f=$("<div>",{"class":"ust-gallery-preview","data-mediaid":t});f.append('<a data-icon="bin" class="st-block-ui-btn st-block-ui-btn--delete st-icon">delete<\/a>');r.$editor.find(".ust-gallery").append(f);u.getById(t).then(function(n){var u=r.$editor.find(".ust-gallery-preview[data-mediaid='"+t+"']"),f=i.resolveFile(n,!0);$(u).css("background-image","url("+f+")");$(u).data("mediacontenttypealias",n.contentTypeAlias)})}})}();
/*
//# sourceMappingURL=umbraco-gallery.min.js.map
*/