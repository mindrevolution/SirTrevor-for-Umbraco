SirTrevor.Blocks.UmbracoGallery=function(){var t=angular.element("body").injector(),i=t.get("mediaHelper"),r=t.get("dialogService"),u=t.get("mediaResource"),n;return SirTrevor.Block.extend({type:"umbraco_gallery",title:function(){return"Gallery"},icon_name:"image",droppable:!1,uploadable:!1,pastable:!1,ajaxable:!1,controllable:!0,controls:{add:function(t){n=this;t.preventDefault();this.pickImages()}},loadData:function(t){n=this;this.$editor.empty();this.$editor.append($("<ol>",{"class":"ust-gallery"}));angular.forEach(t.items,function(t){n.addImage(t.id)});$(this.$editor).find(".ust-gallery").on("click",".st-block-ui-btn--delete",function(){$(this).parent("li").remove();n.onMediaChanged()})},onBlockRender:function(){(typeof this.blockStorage.data.itemcount=="undefined"||this.blockStorage.data.itemcount<1)&&(n=this,this.pickImages())},pickImages:function(){r.mediaPicker({onlyImages:!0,callback:this.onMediaChanged,multiPicker:!0})},onMediaChanged:function(t){var r=[],i;angular.forEach(n.$editor.find(".ust-gallery .ust-gallery-preview"),function(n){var t={};t.id=$(n).data("mediaid");t.contentTypeAlias=$(n).data("mediacontenttypealias");r.push(t)});t!==undefined&&angular.forEach(t,function(n){var t={};t.id=n.id;t.contentTypeAlias=n.contentTypeAlias;r.push(t)});i={};i.itemcount=r.length;i.items=r;t===undefined?n.setData(i):(n.setAndLoadData(i),n.ready())},addImage:function(t){var r=n,f=$("<li>",{"class":"ust-gallery-preview","data-mediaid":t});f.append($("<a>",{"class":"st-icon st-block-ui-btn--delete","data-icon":"bin"}));r.$editor.find(".ust-gallery").append(f);u.getById(t).then(function(n){var u=r.$editor.find(".ust-gallery-preview[data-mediaid='"+t+"']"),f=i.resolveFile(n,!0);$(u).css("background-image","url("+f+")");$(u).data("mediacontenttypealias",n.contentTypeAlias)});$(r.$editor.find(".ust-gallery")).sortable().bind("sortupdate",function(){var i=[],t;angular.forEach(n.$editor.find(".ust-gallery .ust-gallery-preview"),function(n){var t={};t.id=$(n).data("mediaid");t.contentTypeAlias=$(n).data("mediacontenttypealias");i.push(t)});t={};t.itemcount=i.length;t.items=i;n.setData(t);n.data=t;n.ready()})}})}(),function(n){var t,i=n();n.fn.sortable=function(r){var u=String(r);return r=n.extend({connectWith:!1},r),this.each(function(){var o,s,f,e;if(/^enable|disable|destroy$/.test(u)){f=n(this).children(n(this).data("items")).attr("draggable",u=="enable");u=="destroy"&&f.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s");return}f=n(this).children(r.items);e=n("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');f.find(r.handle).mousedown(function(){o=!0}).mouseup(function(){o=!1});n(this).data("items",r.items);i=i.add(e);r.connectWith&&n(r.connectWith).add(this).data("connectWith",r.connectWith);f.attr("draggable","true").on("dragstart.h5s",function(i){if(r.handle&&!o)return!1;o=!1;var u=i.originalEvent.dataTransfer;u.effectAllowed="move";u.setData("Text","dummy");s=(t=n(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){t.removeClass("sortable-dragging").show();i.detach();s!=t.index()&&f.parent().trigger("sortupdate",{item:t});t=null}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,e]).on("dragover.h5s dragenter.h5s drop.h5s",function(u){return!f.is(t)&&r.connectWith!==n(t).parent().data("connectWith")?!0:u.type=="drop"?(u.stopPropagation(),i.filter(":visible").after(t),!1):(u.preventDefault(),u.originalEvent.dataTransfer.dropEffect="move",f.is(this)?(r.forcePlaceholderSize&&e.height(t.outerHeight()),t.hide(),n(this)[e.index()<n(this).index()?"after":"before"](e),i.not(e).detach()):i.is(this)||n(this).children(r.items).length||(i.detach(),n(this).append(e)),!1)})})}}(jQuery);
/*
//# sourceMappingURL=umbraco-gallery.min.js.map
*/